@{
  Page.Title = "Nested Knockout";
}
<script>
  var trigger1 = {
    Title: "annual meeting",
    Date: new Date("1/15/2012"),
    Actions: new Array(
       { channel: "action1", date: "1/12/2012" },
       { channel: "action2", date: "2/12/2012" }
    )
  }

  var trigger2 = {
    Title: "brown bag",
    Date: new Date("2/15/2012"),
    Actions: new Array()
  }


  var data = new Array(trigger1, trigger2);
  function setupModel() {
    var viewModel = {
      triggers: ko.mapping.fromJS(data)
    }
    ko.applyBindings(viewModel);
    return viewModel;
  }

</script>
<!-- The tests -->
<script>

  $(function () {
    // calculator_tests.js
    module("Triggers");
//    test("Should bind to template", function () {
//      var viewModel = setupModel();
//      ok(viewModel, "ViewModel is a O.K.");
//      equals(viewModel.triggers().length, 2, "2 Triggers");
//    });

//    test("new trigger should show in template", function () {
//      var viewModel = setupModel();
//      var trigger3 = {
//        Title: "3rd trigger",
//        Date: new Date("3/15/2012"),
//        Actions: null
//      }
//      viewModel.triggers.push(trigger3);
//      ok(viewModel, "ViewModel is a O.K.");

//      equals(viewModel.triggers().length, 3, "2 Triggers");
//    });

//    test("child actions should be two", function () {
//      var viewModel = setupModel();

//      ok(viewModel, "ViewModel is a O.K.");
//      var actions = viewModel.triggers()[0].Actions();
//      equals(actions.length, 2, "2 action");
//    });
     
    test("add new action to trigger", function () {
      var viewModel = setupModel();

      ok(viewModel, "ViewModel is a O.K.");
      var actions = viewModel.triggers()[1].Actions();
      equals(actions.length, 0, "0 action");
      equals($('.action').length, 2, "2 actions in dom");
      equals(actions.length, 0, "0 action in our trigger");
       
      // act 
      viewModel.triggers()[1].Actions.push({ channel: "action3", date: "3/12/2012" });
      
       // assert
      equals(actions.length, 1, "1 action in our trigger");
      equals($('.action').length, 3, "3 actions in dom");
    });
  });
</script>
<ul class="triggers" data-bind="foreach: triggers">
  <li class="trigger">
    <div class="summary">
      <button class="btn delete danger outer-left">x</button>
      <div class='date' data-bind="text: Date">
      </div>
      <div class='title' data-bind="text: Title">
      </div>
    </div>
    <ul data-bind="foreach: Actions">
      <li class="action"><span data-bind="text: date">
      </span>
        <div class="channel">
          <span data-bind="text: channel"></span>
          <button class="btn delete danger">x</button>
        </div>
      </li>
    </ul>
  </li>
</ul>
<script src="/Views/_Scripts/ko-protected-observable.js" type="text/javascript"></script>
<script src="/Views/_Scripts/CrudHelpers.js" type="text/javascript"></script>
<script src="/Content/lib/knockout/knockout-1.3.0beta.js" type="text/javascript"></script>
<script src="/Content/lib/knockout/knockout-mapping.js" type="text/javascript"></script>
